<!DOCTYPE>
<html>

<head>
    <meta charset="utf-8" />
    <title>ClassViewer</title>
</head>

<body>
    <input type="file" id="file" accept=".class" />
    <button type="button" onclick="loadfile()">读取文件</button>
</body>

<script src="js/utils.js"></script>
<script src="js/class_reader.js"></script>
<script src="js/const_infos.js"></script>
<script src="js/const_pool.js"></script>
<script src="js/attr_table.js"></script>
<script src="js/classfile.js"></script>

<script>
    function loadfile() {
        var file = document.getElementById("file").files[0]

        var reader = new FileReader();
        reader.onload = function (event) {
            var file = new ClassFile(event.target.result)

            file.parse()

            printclass(file)
        }
        reader.readAsArrayBuffer(file)
    }

    function printclass(klass) {
        let const_pool = klass.const_pool

        log("类名", const_pool.className(klass.this_class))
        log("父类", const_pool.className(klass.super_class))

        var printmember = (type, members) => {
            log(type)
            for (const member of members) {
                log(const_pool.getUtf8String(member.name_index))
            }
        }

        printmember("属性", klass.fields)
        printmember("方法", klass.methods)
    }
</script>

</html>