<!DOCTYPE>
<html>

<head>
    <meta charset="utf-8" />
    <title>ClassViewer</title>
    <link href="http://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="lib/ztree/css/zTreeStyle.css" rel="stylesheet">
    <style>
        .class-info>ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .class-info>ul>li {
            margin-bottom: 10px;
            cursor: pointer;
        }

        .wrapper>* {
            display: inline-block;
            padding: 0;
            margin: 0;
            vertical-align: top;
        }

        li>span:hover,
        li.active {
            background: blue;
        }

        span.value {
            margin-left: 3px;
        }

        main {
            width: calc(100% - 450px);
        }

        aside.class-info {
            width: 200px;
        }

        aside.detail-info {
            width: 200px;
        }

        ul.sublist {
            list-style: none;
            padding: 0;
            margin: 0;
            display: block;
        }
    </style>
</head>

<body>

    <header>
        <span>
            <i class="fa fa-upload" aria-hidden="true"></i>
        </span>
        <input type="file" id="file" accept=".class" />

        <button type="button" onclick="loadfile()">
            </i>读取文件</button>
    </header>
    <div class="wrapper">

        <aside class="class-info">
            <ul id="infoTree" class="ztree"></ul>
        </aside>
        <main>
            <canvas id="bytearea" width="600px" height="200px">

            </canvas>
        </main>
        <aside class="detail-info" style="background-color:green">
            测试
        </aside>
    </div>

</body>

<!--lib-->
<script src="lib/jquery.min.js"></script>
<script src="lib/ztree/js/jquery.ztree.core.min.js"></script>


<script src="js/utils.js"></script>
<script src="js/parser/class_reader.js"></script>
<script src="js/parser/const_infos.js"></script>
<script src="js/parser/const_pool.js"></script>
<script src="js/parser/attr_table.js"></script>
<script src="js/parser/classfile.js"></script>

<script src="js/painter/byte_painter.js"></script>

<script src="js/dom.js"></script>
<script src="js/show_class_info.js"></script>
<script src=""></script>
<script>
    var buffer = []
    function loadfile() {
        var file = document.getElementById("file").files[0]

        var reader = new FileReader();
        reader.onload = function (event) {
            buffer = event.target.result

            var file = new ClassFile(buffer.slice(0))

            file.parse()

            printclass(file)
        }
        reader.readAsArrayBuffer(file)
    }

    function printclass(klass) {
        let const_pool = klass.const_pool

        log("类名", const_pool.className(klass.this_class))
        log("父类", const_pool.className(klass.super_class))

        var printmember = (type, members) => {
            log(type)
            for (const member of members) {
                log(const_pool.getUtf8String(member.name_index))
            }
        }

        printmember("属性", klass.fields)
        printmember("方法", klass.methods)

        showClass(klass)
    }


    function showClass(klass) {
        let show = new ShowClassInfo(klass, "#infoTree")
        show.show()
    }

    function paintByteArea() {
        let data = []

        for (let i = 0; i < 11; i++) {
            data.push.apply(data, [0xca, 0xfe, 0xba, 0xbe])
        }


        let painter = new ByteAreaPainter("main", new Uint8Array(data))

        painter.draw()

        return painter
        // painter.highlight(10,20)
        // painter.highlight(20,30)
    }

</script>

</html>